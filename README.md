[![nlpsandbox.io](https://nlpsandbox.github.io/nlpsandbox-themes/banner/Banner@3x.png)](https://nlpsandbox.io)

# NLP Sandbox Date Annotator Example

[![GitHub Release](https://img.shields.io/github/release/nlpsandbox/date-annotator-example.svg?include_prereleases&color=94398d&labelColor=555555&logoColor=ffffff&style=for-the-badge&logo=github)](https://github.com/nlpsandbox/date-annotator-example/releases)
[![GitHub CI](https://img.shields.io/github/workflow/status/nlpsandbox/date-annotator-example/ci.svg?color=94398d&labelColor=555555&logoColor=ffffff&style=for-the-badge&logo=github)](https://github.com/nlpsandbox/date-annotator-example/actions)
[![GitHub License](https://img.shields.io/github/license/nlpsandbox/date-annotator-example.svg?color=94398d&labelColor=555555&logoColor=ffffff&style=for-the-badge&logo=github)](https://github.com/nlpsandbox/date-annotator-example/blob/develop/LICENSE)
[![Docker](https://img.shields.io/badge/docker-blue.svg?color=94398d&labelColor=555555&logoColor=ffffff&style=for-the-badge&label=nlpsandbox&logo=data:image/svg%2bxml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtMy4yIDcuOS0xLjctMXYxMS40bDkuOSA1LjdWMTIuNkw1LjYgOS4zIDMuMiA3Ljl6bTE3LjEtMS4zIDEuNS0uOUwxMiAwIDIuMiA1LjdsMi42IDEuNS4xLjEgMS43IDEgNS41IDMuMiA1LjEtMyAzLjEtMS45ek0xMiA5LjUgOS4zIDcuOSA3LjQgNi44bC0xLjctMS0uMS0uMWgtLjFMMTIgMS45bDYuNSAzLjhMMTYuMyA3IDEyIDkuNXptOC44LTEuNi0yLjQgMS40LS41LjItNS4zIDMuMVYyNGw5LjktNS43VjYuOWwtMS43IDF6IiBmaWxsPSIjZmZmIi8+PC9zdmc+)](https://www.synapse.org/#!Synapse:syn25828638 "Get the Docker image of this tool on NLPSandbox.io")
[![Docker](https://img.shields.io/badge/leaderboard-blue.svg?color=94398d&labelColor=555555&logoColor=ffffff&style=for-the-badge&label=nlpsandbox&logo=data:image/svg%2bxml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtMy4yIDcuOS0xLjctMXYxMS40bDkuOSA1LjdWMTIuNkw1LjYgOS4zIDMuMiA3Ljl6bTE3LjEtMS4zIDEuNS0uOUwxMiAwIDIuMiA1LjdsMi42IDEuNS4xLjEgMS43IDEgNS41IDMuMiA1LjEtMyAzLjEtMS45ek0xMiA5LjUgOS4zIDcuOSA3LjQgNi44bC0xLjctMS0uMS0uMWgtLjFMMTIgMS45bDYuNSAzLjhMMTYuMyA3IDEyIDkuNXptOC44LTEuNi0yLjQgMS40LS41LjItNS4zIDMuMVYyNGw5LjktNS43VjYuOWwtMS43IDF6IiBmaWxsPSIjZmZmIi8+PC9zdmc+)](https://www.synapse.org/#!Synapse:syn22277123/wiki/608544 "View the performance of this tool on nlpsandbox.io")
[![Discord](https://img.shields.io/discord/770484164393828373.svg?color=94398d&labelColor=555555&logoColor=ffffff&style=for-the-badge&label=Discord&logo=discord)](https://nlpsandbox.io/discord "Realtime support / chat with the community and the team")

## Introduction

[NLPSandbox.io] is an open platform for benchmarking modular natural language
processing (NLP) tools on both public and private datasets. Academics, students,
and industry professionals are invited to browse the available tasks and
participate by developing and submitting an NLP Sandbox tool.

This repository provides an example implementation of the [NLP Sandbox Date
Annotator API] written in Python-Flask. An NLP Sandbox date annotato takes as
input a clinical note (text) and outputs a list of predicted date annotations
found in the clinical note. Here dates are identified using regular expressions.

This tool is provided to NLP developers who develop in Python as a starting
point to package their own date annotator as an NLP Sandbox tool (see section
[Development](#Development)). This section also describes how to generate a tool
"stub" using [openapi-generator] for 50+ programming languages-frameworks.

This repository includes a GitHub CI/CD workflow that lint, test, build and push
a Docker image of this tool to Synapse Docker Registry. This image of this
example tool can be submitted as-is on NLPSandbox.io to benchmark its
performance -- just don't expect a high performance!

## Specification

- NLP Sandbox Schema version: 1.1.2
- Tool version: 1.1.2
- Docker image: [docker.synapse.org/syn22277123/date-annotator-example]

## Requirements

- [Docker Engine] >=19.03.0

## Usage

### Running with Docker

The command below starts this NLP Sandbox date annotator locally.

```console
docker compose up --build
```

You can stop the container run with `Ctrl+C`, followed by `docker compose down`.

### Running with Python

Create a Conda environment.

```console
conda create --name date-annotator python=3.9
conda activate date-annotator
```

Install and start this NLP Sandbox date annotator.

```console
cd server && pip install -r requirements.txt
python -m openapi_server
```

### Accessing this NLP Sandbox tool User Interface (UI)

This NLP Sandbox tool provides a web interface that you can use to annotate
clinical notes. This web client has been automatically generated by
[openapi-generator]. To access the UI, open a new tab in your browser and
navigate to one of the following address depending on whether you are running
the tool using Docker (production) or Python (development).

- Using Docker: http://localhost/ui
- Using Python: http://localhost:8080/ui

## Development

### Requirements

- [Node] >=14
- [Java] >=1.8 (required by [openapi-generator])
- [Conda] >=4 and/or [Python] >= 3.7
- [Synapse.org] user account to push the image to [docker.synapse.org]













### Creating a new GitHub repository

This step will depend on your preferred programming language-framework.

- If you develop in Python-Flask, create a new repository from this [GitHub
  template].
- If you develop in Java-Spring, create a new repository from the GitHub
  template [nlpsandbox/date-annotator-example-java].

If you prefer to develop using another language or if you want to learn how this
repository has been generated, go to the section [Creating a new Date Annotator
from scratch](#Creating-a-new-Date-Annotator-from-scratch).

### Configuring the CI/CD workflow

This repository provides a GitHub CI/CD workflow that performs the following
actions:

- Lint the Python code and Docker files.
- Test this NLP tool (integration tests).
- Build this NLP tool as a Docker image and publish it to DockerHub.

If you wish to enable the above CI/CD actions for your repository, please:

1. Create a public or private Docker repository on DockerHub (or another Docker
   registry).
2. Add the following GitHub Secrets to your repository to specify the
   credentials that the CI/CD workflow will use to push the Docker image to the
   registry.
    - `DOCKERHUB_PASSWORD`
    - `DOCKERHUB_USERNAME`
3. In the CI/CD workflow (.github/workflows/ci.yml), update the environment
   variable listed below with the name of your docker repository.
    - `docker_repository`

Note that the credentials used to push the Docker image to DockerHub must have
the permission `Admin` to push the README of your repository to DockerHub and
complete successfully the CI/CD workflow.

### Docker tags

The CI/CD workflow builds and pushes the following tags to the docker registry:

- The tag `edge` is created when a commit is pushed to the default branch of
  this repository (`develop`).
- The tags `latest`, `x`, `x.y`, `x.y.z` are created when the GitHub release
  `x.y.z` is created.
- The tag `nightly` is created every night everyday at 10am UTC.

### Creating a new Date Annotator from scratch

Follow the steps listed below to generate an initial implementation - also
called "stub" - of the Date Annotator using one of the many languages and
framework supported by [OpenAPITools/openapi-generator].

1. Download the latest OpenAPI specification of the [NLP Sandbox Date Annotator].

       curl -fO https://nlpsandbox.github.io/nlpsandbox-schemas/date-annotator/latest/openapi.yaml

2. Copy the file [package.json] from this repository to your project.
3. Install the development tools defined in *package.json*

       npm ci

4. Display the help information of `openapi-generator-cli`

       ./node_modules/.bin/openapi-generator-cli --help

5. Display the list of programming languages-framework supported by the OpenAPI
   generator to create SERVER stubs.

       ./node_modules/.bin/openapi-generator-cli list

6. Generate the server stub using the generator of your choice (here
   `python-flask`). The option `-o` is to specify the name of the folder where
   the files generated will be saved.

       mkdir server
       ./node_modules/.bin/openapi-generator-cli \
           generate -i openapi.yaml -g python-flask -o server

7. Start your new NLP tool locally by following the instructions outlines in the
   section [Running with Python](#Running-with-Python). Open the page
   http://localhost:8080/ui in your browser to navigate to the web interface of
   the tool. You can now start implementing the different controllers of the
   tools in the folder *server/openapi_server/controllers*. Use the controllers
   defined in this repository as a reference.

### Updating your tool after the release of a new API version

The NLP Sandbox Team and community may introduce changes to the OpenAPI
specifications of the NLP Sandbox Tools. For example, the [Patient schema] may
include in the future a new property that this tool could leverage to generate
more accurate predictions. When this happens, the version of the tool
specifications will be bumped. The latest version of each specification can be
found in the README of the repository [nlpsandbox/nlpsandbox-schemas].

Here is the protocol that we apply to update this example Date Annotator when a
new release of the Date Annotator specification is available:

1. Create a new branch

       git checkout -b update-to-specification-x.y.z

2. Download the latest OpenAPI specification of the Date Annotator.

       curl -fO https://nlpsandbox.github.io/nlpsandbox-schemas/date-annotator/latest/openapi.yaml

3. Re-run the OpenAPI generator using the same command that you have used to
   generated the initial server stub.

       npm run generate:server openapi.yaml

4. Review and merge the changes. If you are using VS Code, this step can be
   performed relatively easily using the section named "Source Control". This
   section lists the files that have been modified by the generator. When
   clicking on a file, VS Code shows side-by-side the current and updated
   version of the file. Changes can be accepted or rejected at the level of an
   entire file or selected lines.

### Testing the NLP tool

This command will check that your Python code adheres to the style guide defined
for this project (see [server/setup.cfg](server/setup.cfg)).

    npm run lint

The command below will run the unit and integration tests.

    npm run test

### Versioning

This package uses [semantic versioning] for releasing new versions. Creating a
GitHub release of this repository will trigger the CI/CD workflow which will in
turn build the new Docker image for this tool before publishing it to DockerHub.

We recommend to include the following information at the top of your README:

- `Date Annotator API version`: The version of the Date Annotator specification
  implemented by the tool.
- `Tool version`: The version of the tool.

Initially, it may be tempting to align the tool version to the API version. As
you improve your tool and fix bugs, you will likely release more than one
version of your tool for the same API version. Note that for the sake of
reproducibility, it is encouraged to not reuse version tags.

## Benchmarking

Visit [nlpsandbox.io] for instructions on how to submit your tool and evaluate
its performance on public and private datasets.

## Contributing

Thinking about contributing to this project? Get started by reading our
[Contributor Guide].

## License

[Apache License 2.0]

<!-- Links -->

[nlpsandbox.io]: https://www.synapse.org/nlpsandbox
[docker.synapse.org/syn22277123/date-annotator-example]: https://www.synapse.org/#!Synapse:syn25828638
[Synapse.org]: https://synapse.org


[NLP Sandbox]: https://www.synapse.org/nlpsandbox
[NLP Sandbox Date Annotator API]: https://nlpsandbox.github.io/nlpsandbox-schemas/date-annotator/latest/docs/
<!-- [docker.synapse.org/syn22277123/date-annotator-example]:  -->
[nlpsandbox/date-annotator-example]: https://hub.docker.com/r/nlpsandbox/date-annotator-example
[GitHub template]: https://github.com/nlpsandbox/date-annotator-example/generate
[NLP Sandbox]: nlpsandbox.io
[nlpsandbox/date-annotator-example-java]: https://github.com/nlpsandbox/date-annotator-example-java
[Apache License 2.0]: https://github.com/nlpsandbox/date-annotator-example/blob/develop/LICENSE
[Patient schema]: https://github.com/nlpsandbox/nlpsandbox-schemas/blob/develop/openapi/commons/components/schemas/Patient.yaml
[nlpsandbox/nlpsandbox-schemas]: https://github.com/nlpsandbox/nlpsandbox-schemas
[semantic versioning]: https://semver.org/
[openapi-generator]: https://github.com/OpenAPITools/openapi-generator
[Contributor Guide]: .github/CONTRIBUTING.md
[Docker Engine]: https://docs.docker.com/engine/install/
[Node]: https://nodejs.org/en/
[Java]: https://www.java.com/en/download/help/download_options.html

[Conda]: https://conda.io/projects/conda/en/latest/user-guide/install/index.html
[Python]: https://www.python.org/downloads/
[docker.synapse.org]: https://synapse.org
